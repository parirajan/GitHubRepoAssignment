workflow:
  rules:
    - when: manual



update_ami_in_west:
  stage: update_ami
  script:
    - |
      for i in 1 2 3; do
        update_launch_template_or_config "us-west-1" "svc-us-west-1-${i}" "my-custom-ami-prefix"
      done

update_ami_in_east:
  stage: update_ami
  script:
    - |
      for i in 1 2 3; do
        update_launch_template_or_config "us-east-1" "svc-us-east-1-${i}" "my-custom-ami-prefix"
      done

refresh_asg_in_west:
  stage: refresh_asg
  needs: [update_ami_in_west]  # This job needs the 'update_ami_in_west' job to complete first
  script:
    - |
      for i in 1 2 3; do
        refresh_autoscaling_group "us-west-1" "svc-us-west-1-${i}"
      done

refresh_asg_in_east:
  stage: refresh_asg
  needs: [update_ami_in_east]  # This job needs the 'update_ami_in_east' job to complete first
  script:
    - |
      for i in 1 2 3; do
        refresh_autoscaling_group "us-east-1" "svc-us-east-1-${i}"
      done
