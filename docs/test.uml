@startuml
actor DeploymentTeam
participant "Consul Seeder" as ConsulSeeder
participant "Consul KV Store" as ConsulKV
participant "Cluster Watch Script (Dev)" as DevWatchScript
participant "Cluster Watch Script (QA)" as QAWatchScript
participant "Cluster Watch Script (DIT)" as DITWatchScript
participant "Cluster Watch Script (Prod)" as ProdWatchScript
participant "S3 Bucket (Appcore)" as S3Bucket
participant "Modelling Cluster (Dev)" as DevModelling
participant "Modelling Cluster (QA)" as QAModelling
participant "Modelling Cluster (DIT)" as DITModelling
participant "Modelling Cluster (Prod)" as ProdModelling
participant "Execution Cluster (Dev)" as DevExecution
participant "Execution Cluster (QA)" as QAExecution
participant "Execution Cluster (DIT)" as DITExecution
participant "Execution Cluster (Prod)" as ProdExecution
participant "Log System" as LogSystem

' Step 1: Deployment team updates version in Consul
DeploymentTeam -> ConsulSeeder: Set Journal Version
ConsulSeeder -> ConsulKV: Update Version in KV Store

' Step 2: Consul Watch Script in each cluster picks up the update
ConsulKV -> DevWatchScript: Trigger Watch Process (Dev)
ConsulKV -> QAWatchScript: Trigger Watch Process (QA)
ConsulKV -> DITWatchScript: Trigger Watch Process (DIT)
ConsulKV -> ProdWatchScript: Trigger Watch Process (Prod)

' Step 3: Watch script downloads the journal file based on version
DevWatchScript -> S3Bucket: Download Journal (Dev)
QAWatchScript -> S3Bucket: Download Journal (QA)
DITWatchScript -> S3Bucket: Download Journal (DIT)
ProdWatchScript -> S3Bucket: Download Journal (Prod)

' Step 4: Import process with rules
' Dev Cluster imports only Tech Head Mandator changes
DevWatchScript -> DevModelling: Import Tech Head Mandator (Dev)
DevWatchScript -> DevExecution: Import Tech Head Mandator (Dev)

' QA Cluster imports Tech and Business Head Mandators
QAWatchScript -> QAModelling: Import Tech & Business Head Mandators (QA)
QAWatchScript -> QAExecution: Import Tech & Business Head Mandators (QA)

' DIT Cluster imports Tech and Business Head Mandators
DITWatchScript -> DITModelling: Import Tech & Business Head Mandators (DIT)
DITWatchScript -> DITExecution: Import Tech & Business Head Mandators (DIT)

' Prod Cluster imports only Tech Head Mandator, not Business Mandator
ProdWatchScript -> ProdModelling: Import Tech Head Mandator (Prod)
ProdWatchScript -> ProdExecution: Import Tech Head Mandator (Prod)
ProdWatchScript -> ProdModelling: Skip Business Head Mandator (Prod)

' Step 5: Log the result of the import process
DevModelling -> LogSystem: Log Success (Dev)
QAExecution -> LogSystem: Log Success (QA)
DITExecution -> LogSystem: Log Success (DIT)
ProdExecution -> LogSystem: Log Success (Prod)
@enduml
