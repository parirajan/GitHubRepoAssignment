@startuml
!define AWSCOLOR #FF9900
!define GITLABCOLOR #FC6D26
!define VAULTCOLOR #0000FF

skinparam ParticipantBackgroundColor AWSCOLOR
skinparam ParticipantBorderColor AWSCOLOR

participant User
participant "GitLab Pipeline" as GitLab #GITLABCOLOR
participant "GitLab Runner\nwith vaultadmin IAM role" as Runner #AWSCOLOR
participant "AWS IAM\n(vaultadmin role)" as IAM #AWSCOLOR
participant Vault #VAULTCOLOR

User -> GitLab : Triggers pipeline
activate GitLab

GitLab -> Runner : Starts runner
activate Runner

Runner -> IAM : Assumes vaultadmin IAM role
activate IAM

IAM -> Vault : Auth via AWS IAM auth method\nwith admin policy
activate Vault

Vault --> IAM : Auth successful
deactivate Vault

Runner -> Vault : Perform admin tasks
activate Vault

Vault --> Runner : Tasks completed
deactivate Vault

Runner --> GitLab : Pipeline job complete
deactivate Runner

GitLab --> User : Pipeline completed
deactivate GitLab
@enduml
