@startuml
skinparam monochrome true

start

:Start Deployment Process;

partition "Retrieve SBOM/OBOM" {
    :Fetch latest SBOM/OBOM from secure storage;
    :Extract artifact version and timestamp info;
}

partition "Check Cluster Version" {
    :Query current running version on cluster;
    :Compare with SBOM/OBOM version;
}

partition "Determine Delta Versions" {
    if (Delta exists?) then (yes)
        :List all intermediate versions\nbetween current and SBOM/OBOM version;
        :Query GitLab for delta artifacts;
    else (no)
        :No update required;
        stop
    endif
}

partition "Stage Delta Artifacts" {
    :Pull delta artifacts for all\nfour types to staging area;
}

partition "Sequential Deployment" {
    :Run pre-deployment checks;
    while (Each version in delta)
        :Deploy artifacts sequentially;
        :Execute import/API save scripts;
    endwhile
}

partition "Verify Deployment" {
    :Check all artifacts are deployed correctly;
    if (Deployment successful?) then (yes)
        :Update cluster version state to new version;
    else (no)
        :Log deployment failure;
        stop
    endif
}

stop
@enduml
