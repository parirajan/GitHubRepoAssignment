@startuml
!define USERCOLOR #00FF00
!define GITLABCOLOR #FFFF00
!define RUNNERCOLOR #FC6D26
!define IAMCOLOR #FF0000
!define VAULTCOLOR #8B0000

' Setting background and border colors for participants
skinparam ParticipantBackgroundColor AWSCOLOR
skinparam ParticipantBorderColor AWSCOLOR
skinparam ParticipantBackgroundColor<<user>> USERCOLOR
skinparam ParticipantBorderColor<<user>> USERCOLOR
skinparam ParticipantBackgroundColor<<gitlab>> GITLABCOLOR
skinparam ParticipantBorderColor<<gitlab>> GITLABCOLOR
skinparam ParticipantBackgroundColor<<runner>> RUNNERCOLOR
skinparam ParticipantBorderColor<<runner>> RUNNERCOLOR
skinparam ParticipantBackgroundColor<<iam>> IAMCOLOR
skinparam ParticipantBorderColor<<iam>> IAMCOLOR
skinparam ParticipantBackgroundColor<<vault>> VAULTCOLOR
skinparam ParticipantBorderColor<<vault>> VAULTCOLOR

' Define the boundary for AWS accounts
skinparam BoxPadding 10

box "AppCore AWS Account" #LightBlue
participant User <<user>>
participant "GitLab Repository" as Repo <<gitlab>>
participant "GitLab Runner\nfrom AppCore" as AppCoreRunner <<runner>>
end box

box "Vault AWS Account" #LightGreen
participant "AWS IAM\n(for setup)" as SetupIAM <<iam>>
participant Vault <<vault>>
end box

' User commits code to a branch and creates an MR
User -> Repo : Commits code to branch
activate Repo
User -> Repo : Creates merge request (MR)
Repo -> User : MR reviewed
Repo -> AppCoreRunner : Merge MR into main
deactivate Repo

' Environment setup runner actions
AppCoreRunner -> SetupIAM : Assumes role to the Vault account
activate SetupIAM
SetupIAM -> Vault : Creates Vault cluster
SetupIAM -> Vault : Attaches Vault admin IAM role
SetupIAM -> Vault : Creates Vault admin roles
deactivate SetupIAM

' Finalizing Phase 0
AppCoreRunner --> Repo : Job executed and completed
@enduml
