@startuml
participant "Node 1" as Node1
participant "Node 2" as Node2
participant "Node 3" as Node3

entity "Consul Server" as Consul

participant "Consul Client (Node 1)" as ClientNode1
participant "Consul Client (Node 2)" as ClientNode2
participant "Consul Client (Node 3)" as ClientNode3

ClientNode1 -[hidden]-> Node1
ClientNode2 -[hidden]-> Node2
ClientNode3 -[hidden]-> Node3

ClientNode1 -> Consul: Create Session

Node1 -> Consul: Acquire Lock with Session
Consul -> Node1: Lock Acquired

Node2 -> Consul: Attempt to Acquire Lock
Consul -> Node2: Lock Denied

Node3 -> Consul: Attempt to Acquire Lock
Consul -> Node3: Lock Denied

Node1 -> Node1: Execute Script

ClientNode1 -> Consul: Renew Session

ClientNode1 -> Consul: Session Expired or Failure Detected
Consul -> Node1: Lock Released

ClientNode2 -> Consul: Create New Session
Node2 -> Consul: Acquire Lock with New Session
Consul -> Node2: Lock Acquired
Node2 -> Node2: Execute Script

Consul -> Node3: Lock Still Held by Node2

@enduml
