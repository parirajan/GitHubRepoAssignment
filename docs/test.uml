@startuml
skinparam monochrome true

start

:Document all changes in ServiceNow;

partition "Collect Data" {
    fork
        :Trigger script to collect data\nfrom Dev Cluster;
        :Save data payload and tech head journal\nto temporary storage;
    fork again
        :Trigger script to collect data\nfrom Model Cluster;
        :Save business head journal and app journal\nto temporary storage;
    end fork
}

partition "Prepare Artifacts" {
    :Format and label data with timestamp and version;
    :Package all data into structured directories;
}

partition "Upload Artifacts" {
    :Upload packaged artifacts to GitLab;
    :Set artifact expiration policy;
}

partition "Version File Creation" {
    :Generate version file based on CI_PIPELINE_IID;
    :Upload version file alongside artifacts;
}

partition "Deployment" {
    :Check current version on target clusters;
    :Calculate versions to deploy;
    if (Need to deploy new versions?) then (yes)
        :Deploy new versions sequentially;
    else (no)
        :Skip deployment;
    endif
}

stop
@enduml
