@startuml
title Terraform Management of RDS Master Password with Vault and IAM Authentication

skinparam participant {
    BackgroundColor<<Pipeline>> LightSkyBlue
    BackgroundColor<<Terraform>> LightYellow
    BackgroundColor<<Vault>> LightGreen
    BackgroundColor<<AWS RDS>> LightCoral
    BorderColor Black
    FontSize 14
    FontColor Black
}

actor "GitLab CI/CD Pipeline" as Pipeline <<Pipeline>>
participant "Terraform" as TF <<Terraform>>
participant "Vault (Secret Management)" as Vault <<Vault>>
participant "AWS RDS Instance" as RDS <<AWS RDS>>

Pipeline -> TF : Trigger Terraform Plan/Apply
TF -> TF : Generate Random Password\n(using Terraform module)
TF -> Vault : Store Password in Vault\n(Encrypted Secret)
Vault --> TF : Password Stored Successfully

TF -> RDS : Create/Modify RDS Instance\nwith Password from Vault
RDS --> TF : RDS Instance Created

Pipeline -> RDS : Enable IAM Authentication
RDS -> Pipeline : IAM Authentication Enabled

Pipeline -> TF : Rotate Password (if needed)
TF -> Vault : Update Password in Vault
Vault --> RDS : Password Updated Automatically

note left
  Key Steps:
  - Store master password securely in Vault.
  - Enable IAM authentication for secure access.
  - Transition to IAM-based authentication to minimize password dependency.
end note

@enduml
