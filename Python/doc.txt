# Safer Payments Journal Export/Import Automation – Testing Plan

This document outlines the various tests required for ensuring the correctness, safety, and observability of the journal export/import process in Safer Payments.

---

## 1. Functional Testing

### Export Side
- Ensure all actions/events are exported (journal completeness).
- Validate timestamp-based ordering of entries.
- Verify schema/structure of exported journal files.
- Test retry/resume logic on failure.

### Import Side (Triggered via Consul Watch)
- Ensure Consul KV is updated atomically.
- Validate Consul watch triggers import only once.
- Confirm sequential import (no older journal replays).
- Check import idempotency.

---

## 2. End-to-End Integration Testing
- Deploy source and target clusters.
- Automate the full journal promotion pipeline:
  - Export → S3 → Consul KV Update → Import
- Simulate mid-process failures and validate recovery.

---

## 3. Regression Testing
- After changes to scripts or APIs, re-test older journal versions.
- Validate backward compatibility of journal format.

---

## 4. Data Integrity Testing
- Validate checksums before and after upload/import.
- Simulate corrupted files and check graceful error handling.

---

## 5. Negative Testing
- Missing/malformed Consul KV entries.
- Broken/missing journal files in S3.
- API errors on target during import.
- Out-of-sequence journal injection.

---

## 6. Performance Testing
- Export/import large volumes and measure:
  - Latency
  - Throughput
  - Script execution time

---

## 7. Security Testing
- IAM policies for S3 access
- Consul KV ACLs
- API authentication and authorization
- Journal tampering detection

---

## 8. Observability Testing
- Log accuracy and completeness
- Metrics for journal progress, errors, and retries
- Alerts for failures, delays, and anomalies

---

## 9. Roll-forward Testing
- Simulate missed journal imports
- Ensure system detects and reports skipped versions

---

## 10. Disaster Recovery Testing
- Replay older journals on a clean cluster
- Re-trigger imports manually from Consul
- Ensure export journals are archived with versioning
